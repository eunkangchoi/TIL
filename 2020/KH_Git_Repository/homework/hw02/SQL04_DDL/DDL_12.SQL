-- 문제12. 모든 학과의 학과별 학생 수를 확인할 수 있도록
-- 적절한 VIEW를 작성해보자.
-- 뷰이름: VW_학과별학생수
-- 컬럼
-- DEPARTMENT_NAME
-- STUDENT_COUNT

--1) SYSTEM 계정으로부터 CREATE VIEW 권한을 부여받는다.
-- SYSTEM계정
GRANT CREATE VIEW TO CHOON;

--2) 학과별 학생 수 구하기
SELECT DEPARTMENT_NAME, COUNT(*)
FROM TB_DEPARTMENT
    JOIN TB_STUDENT USING (DEPARTMENT_NO)
GROUP BY DEPARTMENT_NAME;

--3) 2)에서 작성한 쿼리문을 바탕으로 테이블복사하여
-- COUNT_STUDENT라는 이름의 새 테이블을 만든다.
CREATE TABLE COUNT_STUDENT
AS
SELECT DEPARTMENT_NAME 학과이름, COUNT(*) "학생 수"
FROM TB_DEPARTMENT
        JOIN TB_STUDENT USING(DEPARTMENT_NO)
GROUP BY DEPARTMENT_NAME;


--4) 뷰 생성하기 : 3)에서 만든 테이블을 바탕으로 뷰를 만든다.
CREATE OR REPLACE VIEW VW_학과별학생수
AS
SELECT *
FROM COUNT_STUDENT;

--5) 뷰확인
SELECT *
FROM VW_학과별학생수;


--ANSWER
CREATE TABLE COUNT_STUDENT
AS
SELECT DEPARTMENT_NAME 학과이름, COUNT(*) "학생 수"
FROM TB_DEPARTMENT
        JOIN TB_STUDENT USING(DEPARTMENT_NO)
GROUP BY DEPARTMENT_NAME;

CREATE OR REPLACE VIEW VW_학과별학생수
AS
SELECT *
FROM COUNT_STUDENT;


--정답
